FROM nvidia/cuda:9.0-cudnn7-devel-ubuntu16.04 

RUN sed -i 's/archive.ubuntu.com/mirrors.ustc.edu.cn/g' /etc/apt/sources.list \
    && apt-get clean \
    && apt-get update \
    && apt-get install -yq --no-install-recommends \
    python3.5 \
    python3-pip \
    && pip3 install setuptools -i https://mirrors.ustc.edu.cn/pypi/web/simple
# RUN pip3 install --upgrade pip==10.0.0 \
#     && pip3 install setuptools

# RUN pip3 install setuptools -i https://mirrors.ustc.edu.cn/pypi/web/simple

# for flask web server
EXPOSE 5000

# set working directory
# ADD . /SSD_app
WORKDIR /SSD_Flask_docker

# install required libraries
COPY numpy-1.18.2-cp35-cp35m-manylinux1_x86_64.whl ./
COPY torch-1.2.0-cp35-cp35m-manylinux1_x86_64.whl ./ 
COPY requirements.txt ./
RUN pip3 install numpy-1.18.2-cp35-cp35m-manylinux1_x86_64.whl \
    && pip3 install torch-1.2.0-cp35-cp35m-manylinux1_x86_64.whl \
    && pip3 install -r requirements.txt -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com

# This is the runtime command for the container
CMD /bash/bin
